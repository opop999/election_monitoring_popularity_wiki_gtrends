---
title: "Dashboard Wikipedia Article Views"
date: "Last updated `r format (Sys.time(),'%d. %m. %Y')`"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
    source_code: https://github.com/opop999/election_monitoring_wiki_popularity
---

```{r setup, include=FALSE}
# Disable scientific notation of numbers
options(scipen = 999)

# Package names
packages <- c("flexdashboard", "dplyr", "ggplot2", "plotly", "forcats", "htmlwidgets")

# Install packages not yet installed
installed_packages <- packages %in% rownames(installed.packages())
if (any(installed_packages == FALSE)) {
  install.packages(packages[!installed_packages])
}

# Packages loading
invisible(lapply(packages, library, character.only = TRUE))

# Specify output directory
directory <- "data/html_plots"

# Check whether output directory exists to save individual plots
if (!dir.exists(directory)) {
  dir.create(directory)
} else {
  print("Output directory already exists")
}

# Datasets loading
df_all <- readRDS(file = "data/full_data.rds")

df_total <- readRDS(file = "data/summary_tables/total_views_summary.rds")

df_per_year <- readRDS(file = "data/summary_tables/per_year_views_summary.rds")

```

Total
=====================================


Column
-----------------------------------------------------------------------

### Chart A

```{r}
df_total$entity_name <- with(df_total, reorder(entity_name, total_views))

plot_total_views <- ggplotly(
  df_total %>%
    mutate(total_views_thousand = total_views / 1000) %>%
    ggplot(aes(x = total_views_thousand, y = entity_name)) +
    geom_col(fill = "#db1d0b") +
    scale_x_continuous(
      breaks = seq(0, 500, 50),
      labels = seq(0, 500, 50)
    ) +
    theme_minimal() +
    xlab(element_blank()) +
    ylab(element_blank()) +
    ggtitle("Total views (in thousands) of Wikipedia articles since July 2015")
)

plot_total_views

htmlwidgets::saveWidget(plot_total_views, file = paste0(directory, "/plot_total_views.html"))

```
Per Year
=====================================

Column 
-----------------------------------------------------------------------

### Chart B

```{r}
df_per_year$entity_name <- with(df_per_year, reorder(entity_name, total_views))

plot_views_yearly <- ggplotly(
  df_per_year %>%
    mutate(total_views_thousand = total_views / 1000) %>%
    ggplot(aes(x = total_views_thousand, y = entity_name)) +
    geom_col(fill = "#03457f") +
    scale_x_continuous(
      breaks = seq(0, 100, 25),
      labels = seq(0, 100, 25)
    ) +
    theme_minimal() +
    theme(
      panel.border = element_rect(colour = "black", fill = NA, size = 0.5),
      panel.spacing.x = unit(0, "line"),
      strip.background = element_rect(fill = "grey")
    ) +
    facet_grid(cols = vars(year)) +
    xlab(element_blank()) +
    ylab(element_blank()) +
    ggtitle("Views (in thousands) per year of Wikipedia articles since July 2015")
)


plot_views_yearly

htmlwidgets::saveWidget(plot_total_views, file = paste0(directory, "/plot_views_yearly.html"))
```


Throughout Time
=====================================

Column 
-----------------------------------------------------------------------

### Chart C

```{r}
election_date <- as.Date("2021-10-08")

views_over_time <- ggplotly(
  df_all %>%
    arrange(date) %>%
    group_by(entity_name) %>%
    mutate(cumulative_views_thousand = cumsum(views) / 1000) %>%
    ggplot(aes(x = as.Date(date), y = cumulative_views_thousand, color = entity_name)) +
    geom_line() +
    geom_vline(aes(xintercept = as.numeric(election_date)), color = "#db1d0b") +
    geom_text(aes(x = election_date, y = 0, label = "elections"), color = "#03457f", size = 4, angle = 90, vjust = -0.4, hjust = 0) +
    theme_minimal() +
    scale_y_continuous(
      breaks = seq(0, 500, 50),
      labels = seq(0, 500, 50)
    ) +
    scale_x_date(date_breaks = "1 years", date_labels = "%Y") +
    coord_cartesian(xlim = c(as.Date("2015-07-01"), as.Date("2021-12-31"))) +
    theme(legend.title = element_blank()) +
    xlab(element_blank()) +
    ylab(element_blank()) +
    ggtitle("Views (in thousands) of Wikipedia articles since July 2015")
)


views_over_time

htmlwidgets::saveWidget(views_over_time, file = paste0(directory, "/views_over_time.html"))

```

